<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{PROJECT_NAME}} - Web Viewer</title>
    <style>
        :root {
            --bg-color: #050505;
            --accent-color: #00F0FF;
            --text-color: #ffffff;
            --panel-bg: rgba(20, 20, 20, 0.8);
        }

        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            color: var(--text-color);
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Main Stage Area */
        #stage {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            perspective: 2000px;
            overflow: auto;
            /* Allow scrolling when zoomed in */
            position: relative;
        }

        #slide-container {
            width: 960px;
            /* Base Width (720pt * 1.33) */
            height: 540px;
            /* Base Height (405pt * 1.33) */
            position: relative;
            transform-origin: center center;
            transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 50px 100px -20px rgba(0, 0, 0, 0.7);
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
            border-radius: 8px;
            /* Smooth corners */
            display: block;
        }

        /* Floating Control Bar */
        .controls {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--panel-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 12px 24px;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 20px;
            align-items: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            transition: opacity 0.3s, transform 0.3s;
        }

        .controls:hover {
            border-color: rgba(255, 255, 255, 0.3);
        }

        .btn-group {
            display: flex;
            gap: 8px;
            padding: 0 12px;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            align-items: center;
            /* Ensure vertical center alignment */
        }

        .btn-group:last-child {
            border-right: none;
        }

        button {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        button:hover {
            color: var(--accent-color);
            background: rgba(255, 255, 255, 0.05);
            transform: scale(1.1);
        }

        button:active {
            transform: scale(0.95);
        }

        .page-indicator {
            font-variant-numeric: tabular-nums;
            font-size: 14px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
            min-width: 60px;
            text-align: center;
        }

        /* Icons */
        svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
        }

        /* Loader */
        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: none;
            z-index: 10;
        }

        @keyframes spin {
            to {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }
    </style>
</head>

<body>

    <div id="stage">
        <div id="slide-container">
            <div class="loader" id="loader"></div>
            <iframe id="viewer" src=""></iframe>
        </div>
    </div>

    <!-- Control Panel -->
    <div class="controls">
        <!-- Navigation -->
        <div class="btn-group">
            <button onclick="prevSlide()" title="Previous (Left Arrow)">
                <svg viewBox="0 0 24 24">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
            </button>
            <span class="page-indicator" id="page-num">1 / --</span>
            <button onclick="nextSlide()" title="Next (Right Arrow)">
                <svg viewBox="0 0 24 24">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
            </button>
        </div>

        <!-- Zoom -->
        <div class="btn-group">
            <button onclick="zoomOut()" title="Zoom Out (-)">
                <svg viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    <line x1="8" y1="11" x2="14" y2="11"></line>
                </svg>
            </button>
            <button onclick="resetZoom()" title="Fit to Screen (0)">
                <svg viewBox="0 0 24 24">
                    <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"></path>
                </svg>
            </button>
            <button onclick="zoomIn()" title="Zoom In (+)">
                <svg viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    <line x1="11" y1="8" x2="11" y2="14"></line>
                    <line x1="8" y1="11" x2="14" y2="11"></line>
                </svg>
            </button>
        </div>

        <!-- System -->
        <div class="btn-group">
            <button onclick="toggleFullscreen()" title="Fullscreen (F)">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3">
                    </path>
                </svg>
            </button>
        </div>
    </div>

    <script>
        // === CONFIGURATION ===
        // Note: Template variables are strings to avoid JS syntax errors in the template file
        const TOTAL_SLIDES = Number('{{TOTAL_SLIDES}}') || 6;
        const SLIDE_PREFIX = 'assets/slides/slide';
        // ======================

        let currentSlide = 1;
        let scale = 1;
        const container = document.getElementById('slide-container');
        const iframe = document.getElementById('viewer');
        const pageNum = document.getElementById('page-num');
        const loader = document.getElementById('loader');

        // Initial Load
        window.onload = () => {
            loadSlide(1);
            fitToScreen();
            window.addEventListener('resize', fitToScreen);
        };

        function loadSlide(index) {
            if (index < 1 || index > TOTAL_SLIDES) return;

            loader.style.display = 'block';
            currentSlide = index;
            pageNum.innerText = `${currentSlide} / ${TOTAL_SLIDES}`;

            // Fade out effect
            iframe.style.opacity = '0.5';

            iframe.onload = () => {
                iframe.style.opacity = '1';
                loader.style.display = 'none';
            };

            iframe.src = `${SLIDE_PREFIX}${index}.html`;
            iframe.style.transition = 'opacity 0.2s';
        }

        function nextSlide() { loadSlide(currentSlide + 1); }
        function prevSlide() { loadSlide(currentSlide - 1); }

        // --- ZOOM & FIT LOGIC ---
        function setScale(newScale) {
            scale = newScale;
            container.style.transform = `scale(${scale})`;
        }

        function zoomIn() { setScale(scale + 0.1); }
        function zoomOut() { setScale(Math.max(0.2, scale - 0.1)); }

        function resetZoom() { fitToScreen(); }

        function fitToScreen() {
            // Base size of slide (720pt x 405pt = 960px x 540px)
            const baseW = 960;
            const baseH = 540;

            // Reduce padding to maximize size
            // Controls occupy approx 60-70px at bottom. 
            // We leave just enough space so controls don't overlap slide content significantly.
            const paddingBottom = 70;
            const horizontalPadding = 20;

            const availableW = window.innerWidth - horizontalPadding;
            const availableH = window.innerHeight - paddingBottom;

            const scaleW = availableW / baseW;
            const scaleH = availableH / baseH;

            // Fit containment, remove arbitrary max limit to allow full screen filling
            setScale(Math.min(scaleW, scaleH));
        }

        // --- FULLSCREEN ---
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
            }
        }

        // --- KEYBOARD CONTROLS ---
        document.addEventListener('keydown', (e) => {
            switch (e.key) {
                case 'ArrowRight':
                case ' ':
                case 'Enter':
                case 'PageDown':
                    nextSlide(); break;
                case 'ArrowLeft':
                case 'PageUp':
                case 'Backspace':
                    prevSlide(); break;
                case 'f': toggleFullscreen(); break;
                case '+':
                case '=': zoomIn(); break;
                case '-': zoomOut(); break;
                case '0': resetZoom(); break;
            }
        });

        // --- SCROLL WHEEL ZOOM (Optional) ---
        /*
        document.addEventListener('wheel', (e) => {
            if (e.ctrlKey) {
                e.preventDefault();
                if (e.deltaY < 0) zoomIn();
                else zoomOut();
            }
        }, { passive: false });
        */
    </script>
</body>

</html>